new DataTable("#example", {
    responsive: true,
});

$(document).ready(function () {
    window.setTimeout(function () {
        $("#notif-success")
            .fadeTo(500, 0)
            .slideUp(500, function () {
                $(this).remove();
            });
    }, 2000);
    window.setTimeout(function () {
        $("#notif-failed")
            .fadeTo(500, 0)
            .slideUp(500, function () {
                $(this).remove();
            });
    }, 2000);
});

$(document).on("click", "#example .confirm-hapus", function () {
    var getLink = $(this).attr("href");
    Swal.fire({
        title: "Konfirmasi Hapus Data !",
        text: "Data Akan Dihapus, Lanjutkan ?",
        icon: "warning",
        showCancelButton: true,
        confirmButtonText: "Hapus",
        cancelButtonText: "Batal",
        customClass: {
            confirmButton: "btn btn-primary me-2 waves-effect waves-light",
            cancelButton: "btn btn-danger waves-effect",
        },
    }).then(function (result) {
        if (result.isConfirmed) {
            window.location.href = getLink;
        }
    });
    return false;
});

$(".confirm-logout").on("click", function () {
    var getLink = $(this).attr("href");
    Swal.fire({
        title: "Konfirmasi Log Out !",
        html: "Anda Akan Keluar Dari Aplikasi, Lanjutkan ?",
        icon: "warning",
        showCancelButton: true,
        confirmButtonText: "Keluar Aplikasi",
        cancelButtonText: "Batal",
        customClass: {
            confirmButton: "btn btn-primary me-2 waves-effect waves-light",
            cancelButton: "btn btn-danger waves-effect",
        },
    }).then(function (result) {
        if (result.value) {
            Swal.fire({
                title: "",
                html: "Berhasil Logout dari Aplikasi !",
                icon: "success",
                showCancelButton: false,
                showConfirmButton: false,
            });
            setTimeout(function () {
                window.location.href = getLink;
            }, 1700);
        }
    });
    return false;
});

document.addEventListener("DOMContentLoaded", function () {
    const selectElements = $("select[required]");
    const form = $("form");

    form.on("submit", function (event) {
        selectElements.each(function () {
            const selectElement = $(this);
            const invalidFeedback = selectElement
                .closest(".row")
                .find(".invalid-feedback");

            if (selectElement.val() === "") {
                selectElement
                    .next(".select2-container")
                    .addClass("is-invalid")
                    .removeClass("is-valid");
                invalidFeedback.show();
                event.preventDefault();
                event.stopPropagation();
            } else {
                selectElement
                    .next(".select2-container")
                    .removeClass("is-invalid")
                    .addClass("is-valid");
                invalidFeedback.hide();
            }
        });
    });

    selectElements.on("change", function () {
        const selectElement = $(this);
        const invalidFeedback = selectElement
            .closest(".row")
            .find(".invalid-feedback");

        if (selectElement.val() !== "") {
            selectElement
                .next(".select2-container")
                .removeClass("is-invalid")
                .addClass("is-valid");
            invalidFeedback.hide();
        } else {
            selectElement
                .next(".select2-container")
                .addClass("is-invalid")
                .removeClass("is-valid");
            invalidFeedback.show();
        }
    });
});

document.addEventListener("DOMContentLoaded", function () {
    let rupiahInputs = document.getElementsByClassName("rupiah");

    Array.from(rupiahInputs).forEach(function (input) {
        input.addEventListener("input", function (e) {
            // Simpan posisi kursor
            let cursorPos = this.selectionStart;

            // Format input
            let value = this.value;
            let formattedValue = formatRupiah(value, "Rp. ");

            // Hitung perubahan panjang
            let lengthDiff = formattedValue.length - value.length;

            // Set nilai yang sudah diformat
            this.value = formattedValue;

            // Atur ulang posisi kursor
            cursorPos = cursorPos + lengthDiff;
            this.setSelectionRange(cursorPos, cursorPos);
        });
    });
});

function formatRupiah(angka, prefix) {
    let number_string = angka.replace(/[^,\d]/g, "").toString();
    let split = number_string.split(",");
    let sisa = split[0].length % 3;
    let rupiah = split[0].substr(0, sisa);
    let ribuan = split[0].substr(sisa).match(/\d{3}/gi);

    if (ribuan) {
        let separator = sisa ? "." : "";
        rupiah += separator + ribuan.join(".");
    }

    rupiah = split[1] != undefined ? rupiah + "," + split[1] : rupiah;
    return prefix + rupiah;
}
